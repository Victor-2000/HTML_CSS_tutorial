<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      body {
        width: 600px;
        margin: auto;
      }
      ul {
        list-style: none;
      }
      div {
        padding: 1em;
        height: fit-content;
      }
      img {
        clear: both;
        float: left;
        padding-right: 1em;
        margin: auto;
      }
      a {
        text-decoration: none;
        color: #333;
      }
      p {
        padding: 2em;
        border-bottom: 1px solid #e3e3e3;
        height: 130px;
      }
    </style>
  </head>
  <body>
    <ul class="tweets">
      <script id="tweets-template" type="text/x-handlebars-template">
        {{#each this}}
          <div>
            <img src="{{thumb}}" alt="{{author}}" />
            <p>
              <a href="{{url}}">
                {{tweet}}
              </a>
            </p>
          </div>
        {{/each}}
      </script>
    </ul>
    <script src="./twitter.js"></script>
    <script src="../handlebars-v4.7.6.js"></script>
    <script src="../../jquery-3.5.1.js"></script>
    <script>
      (function () {
        var Twitter = {
          init: function (config) {
            this.url = "./twitter.json";
            this.template = $.trim(config.template);
            this.container = config.container;
            this.fetch();
          },

          attachTemplate: function () {
            var template = Handlebars.compile(this.template);
            console.log(this.tweets);
            this.container.append(template(this.tweets));
          },

          fetch: function () {
            var self = this;
            // $.getJSON(this.url, function (data) {
            //   console.log(data);
            // });
            self.tweets = $.map(data.statuses, function (tweet) {
              return {
                author: tweet.user.name,
                tweet: tweet.text,
                thumb:
                  "https://25.media.tumblr.com/tumblr_m2vycqKiHM1qc96lqo1_250.jpg",
                url: `http://twitter.com/${tweet.user.name}/status/${tweet.id_str}`,
              };
            });
            self.attachTemplate();
          },
        };
        Twitter.init({
          template: $("#tweets-template").html(),
          container: $("ul.tweets"),
        });
      })();
    </script>
  </body>
</html>
